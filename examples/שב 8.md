---
sources:
  - "[[PS8_2024.pdf]]"
  - "[[השערות בריגרסיה מרובת משתנים.pdf]]"
  - "[[השערות עם מספר משתנים]]"
---
## שאלה 1
### (א)
כדיי לעבור לפונקציה לינארית נפעיל לוג על 2 צידי המשוואה:
$$
\ln(cost) = \ln(B)+\beta_{y}\ln(Y) + \beta_{1}\ln(P_{L}) + \beta_{2}\ln(P_{k}) + \beta_{3}\ln(P_{F}) + \varepsilon
$$
```R
Call:
lm(formula = lcost ~ ly + lpl + lpk + lpf, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.49179 -0.12897 -0.00924  0.09748  0.86660 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) -8.54875    1.39458  -6.130 2.05e-08 ***
ly           0.82410    0.01309  62.981  < 2e-16 ***
lpl          0.17789    0.14256   1.248    0.215    
lpk          0.20286    0.14457   1.403    0.164    
lpf          0.69325    0.08071   8.590 1.82e-13 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.212 on 94 degrees of freedom
Multiple R-squared:  0.9798,	Adjusted R-squared:  0.979 
F-statistic:  1141 on 4 and 94 DF,  p-value: < 2.2e-16
```

### (ב)
**חלק 1.** 
נעשה מבחן $t$:
$$
\begin{cases}
H_{0}: r = 1 \\
H_{1}: r\neq 1
\end{cases} \implies |t| = \left| \frac{\hat{\beta_{y}}-1}{\sqrt{ \mathrm{Var}(\hat{\beta}_{y}) }} \right| = \left| \frac{0.824-1}{0.013} \right| \gg 2 \implies H_{1}
$$
דוחים את השערת ה-0 וקובעים שאין תשואה קבועה לגודל. אם $\beta_{y}<1\implies r>1$ והמשמעות היא תפוקה עולה לגודל. 

**חלק 2.** 
**נתחיל עם מבחן $t$ :**
$$
\begin{cases}
H_{0}: \sum_{1 }^{3}\beta_{i} = 1 \\
H_{1}: \sum \beta_{i} \neq 1
\end{cases}, \;\; \left| t \right|  = \left| \frac{\sum_{i=1}^{3}\hat{\beta}_{i}-1}{se\left( \sum \hat{\beta}_{i}  \right)} \right| 
$$
```R
cov_mat <- vcov(model )
cov_sum <- 0
idxs <- c("lpl", "lpk", "lpf")
mat_se <- sqrt(sum(cov_mat[idxs, idxs]))
numerator <- sum(coef(model)[idxs]) -1 
t <- numerator / mat_se 
print(t)

---
[1] 0.3581413
```

על פי התוצאה: $|t|\ll 1.96\implies H_{0}$  , כלומר יש תק״ל בין המחירים לעלות.

**נעבור למבחן f**:
$$
\text{Assume } \beta_{1}+\beta_{2}+\beta_{3} = 1 \implies \beta_{3} = 1- \beta_{1}-\beta_{2}
$$
מכאן המודל הלוגריתמי יהיה:
$$
\ln(c ost) = \ln(B) + \beta_{y}\ln(Y) + \beta_{1}\ln(p_{L}) + \beta_{2}\ln(p_{k}) + (1-\beta_{1}-\beta_{2}) \ln(p_{F})
$$
פיתוח אלגברי:
$$
R:\ln\left(  \frac{ co st}{p_{F}} \right) = \ln(B) + \beta_{y}\ln(Y) + \beta_{1}\ln\left( \frac{p_{L}}{p_{F}} \right) + \beta_{2} \ln\left( \frac{p_{K}}{p_{F}} \right) 
$$
כאשר $U:\text{original model}$ 
מכאן שמבחן ה-$f$ יהיה: 
$$
f = \frac{(ESS_{R}-ESS_{U}) / 1}{ESS_{U}/ (99-5)}
$$
```R
model_f <- lm(log(cost / pf) ~ ly + log(pl / pf) + log(pk / pf), data = data)
ess_u <- sum(residuals(model)^2)
ess_r <- sum(residuals(model_f)^2)
n <- nobs(model)
f_val <- (ess_r - ess_u) / (ess_u / (n - 5))
print(f_val)
---------
[1] 0.1282652
```

ערך ה-$f$ יצא קטן ממש מ-4 ולכן לא דוחים את $H_{0}$ וכן יש תק״ל לעלות. 

**חלק 3**. 
$$
\begin{cases}
H_{0}: \left[ \beta_{y}=1, \; \sum_{i=1}^{3}\beta_{i}=1 \right] \\
H_{1}: H_{0}\text{ is false}
\end{cases}
$$
ניסוח מודל מתאים:
$$
\begin{cases}
\beta_{3} = 1-\beta_{1}-\beta_{2} \\
\beta y=1 \\
\end{cases}
$$
$$
R_{2}: \ln\left( \frac{c os t}{Yp_{f}} \right) = B + \beta_{1}\ln\left( \frac{p_{L}}{p_{f}} \right)  + \beta_{2}\ln\left( \frac{p_{K}}{p_{f}}  \right) + \varepsilon
$$
הפעם: $d=2,k=5$: 
```R
model_r2 <- lm(log(cost / (y * pf)) ~ log(pl / pf) + log(pk / pf), data = data)
ess_r2 <- sum(residuals(model_r2)^2)
f2_val <- ((ess_r2 - ess_u) / 2) / (ess_u / (n - 5))
print(f2_val)
---
[1] 95.77195
```

ערך ה-$f$ יצא גדול ממש מ- 3.5 לכן את $H_{0}$. 

```R
coffs <- coef(model)
prediction <- sum(c(
  coffs["(Intercept)"],
  coffs["ly"] * mean(data$ly),
  coffs["lpl"] * mean(data$lpl),
  coffs["lpk"] * mean(data$lpk),
  coffs["lpf"] * mean(data$lpf)
))
prediction

---
> prediction
[1] 3.065995
```


## שאלה 2
### סעיף (א)

```R
params <- data.frame(
  coef = c(0.56, 0.4, 0.18),
  se = c(0.5, 0.65, 0.2),
  row.names = c("M", "L", "K")
)
n <- 38
t_crit <- qt(0.975, df = n - 4)
for (name in rownames(params)) {
  coef <- params[name, "coef"]
  se <- params[name, "se"]
  t <- coef / se
  cat("\n\n", name, ":\nt_val = ", t, "passed_test: ", abs(t) >= t_crit)
}

----
 M :
t_val =  1.12 passed_test:  FALSE

 L :
t_val =  0.6153846 passed_test:  FALSE

 K :
t_val =  0.9 passed_test:  FALSE
>
```

כל המבחנים נכשלו. 

### סעיף (ב)

נגדיר מודל מוגבל $R$:
$$
R: \ln(Y) = \ln(B) ; \;\; U: \ln(Y) = \ln(B) + \beta_{1}\ln(M) + \beta_{2}\ln(L) + \beta_{3}\ln(K)
$$
$$
f = \frac{(ESS_{R}-ESS_{U})/ 3}{ESS_{U} / 34}
$$
מכיוון ש- $R^{2}=1-\frac{ESS}{TSS}\implies ESS=TSS(1-R^{2})$ , כאשר במודל המוגבל, מכיוון שאין כלל משתנים מסבירים, אז $ESS=TSS$ . מכאן שמבחן ה-$f$ יהיה:
$$
f = \frac{(TSS-0.25 TSS)/ 3}{0.25\cdot TSS / (34)} = \frac{\frac{0.75}{3}}{\frac{1}{34}} = \frac{0.25}{0.25 / 34} = 34
$$

ערך ה-$f$ גדול מספיק כדיי לדחות את השערות ה-0 (יש השפעה לקבוצת המשתנים). 

### סעיף (ג). 
בהסתכלות ראשונה, נראה שאכן הממצאים סותרים אחד את השני, אבל חשוב לשים לב לפרטים. בסעיף הראשון, בדקנו מובהקות עבור כל משתנה בנפרד, כלומר ההשפעה שיש למשתנה אחד כאשר השאר קבועים, לעומת זאת בסעיף השני בדקנו השערה לגבי כל המשתנים יחד. מכיוון שהמשתנים מאוד מתואמים בינהם (לפי מטריצת המתאמים), התוצאה הגיונית - יש מולטיקולינאריות גבוה בין כל המשתנים, לכן המודל מתקשה למדוד השפעה של משתנה בודד כאשר השאר קבועים. 

### סעיף (ד).
לא ניתן לבדוק את ההשערה עם הנתונים שקיבלנו כאן, מכיוון שיש צורך ב-שונות המשותפת של האומדים (ולא של המשתנים עצמם).


## שאלה 3
נשתמש במודל Cow-Fisher לשיוויון פרמטרים בין אוכלוסיות.

הפרש דרגות החופש: 4, דרגות החופש במודל המלא: $56-8 = 48$ . 
מכאן ש- 
$$
f= \frac{ESS_{both}-(ESS_{pb}+ESS_{pr})/ 4}{(ESS_{pb}+ESS_{pr})/ 48} 
$$
כאשר ערך ה-$f$ הקריטי על פי טבלת ה-$f$ הוא $\approx 2.5$

```R
ess_pr <- 0.25 * 308
ess_pb <- 0.34 * 240
n_pr <- 38
n_pb <- 18
ess_both <- 0.3 * 650
n_both <- n_pr + n_pb

df_diff <- 4
df <- n_both - 2 * df_diff

f_val <- ((ess_both - ess_pb - ess_pr) / df_diff) / ((ess_pb + ess_pr) / df)
print(f_val)
---
[1] 2.754098
```

**מסקנה**: דוחים את השערת ה-0, ואכן ניתן לקבוע שיש הבדל בתפוקה השולית לתשומות במגזר הפרטי אל מול המגזר הציבורי. 



## שאלה 4
על פי המשוואות, ניתן לראות שהשערת ה-0 של החוקר היתה:
$$
\beta_{2}=0
$$
מכאן ש- $d$ במבחן ה-$f$ שווה ל-1. ומכאן ש- $f=t^{2}\Rightarrow t=\pm 2$ . כמו כן נתון ש- 
$$
\mathrm{Var}\hat{(\hat{\beta}_{2})}=1\implies \sqrt{ \hat{\mathrm{Var}(\hat{\beta}_{2})=1} }\implies \frac{\hat{\beta}_{2}-1}{1}
$$
$$
\implies \hat{\beta}_{2} = -1 \text{ or } \; 3
$$


## שאלה 5
### (א)
```R
Call:
lm(formula = points ~ exper + exper_2 + age + coll, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-11.4736  -3.9849  -0.8246   3.6536  20.9790 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 35.21831    6.98673   5.041 8.62e-07 ***
exper        2.36363    0.40550   5.829 1.62e-08 ***
exper_2     -0.07703    0.02348  -3.280 0.001177 ** 
age         -1.07396    0.29507  -3.640 0.000328 ***
coll        -1.28625    0.45059  -2.855 0.004651 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.509 on 264 degrees of freedom
Multiple R-squared:  0.1412,    Adjusted R-squared:  0.1282 
F-statistic: 10.85 on 4 and 264 DF,  p-value: 3.687e-08
```

המודל מהצורה:
$$
points = \beta_{0} + \beta_{1}ex p e r + \beta_{2} ex per^2 + \beta_{3} age + \beta_{4} coll
$$
כאשר $\beta_{0}$ הוא החותך, $\beta_{1},\beta_{2}$ מייצגים את התשואה לניסיון (תשואה שולית יורדת על פי המודל) , $\beta_{3}$ מייצג את התשואה לגיל ו-$\beta_{4}$ את התשואה לשנות לימוד בקולג. על ממצאי המודל, לכל המשתנים יש תשואה שולית שלילית (כאשר מחזיקים את השאר קבועים), למעט הניסיון שהוא בעל תשואה חיובית אך גם זו פוחתת. 

### (ב)
$$
2.363 = 0.077 x \implies x = 30.68
$$
התשובה היא $30.68$ שנים.

### (ג)
תשובה בגוף השאלה: כדיי להתקבל ל-$NBA$ סביר להניח שצריך להיות טוב במיוחד, ואם מישהו התקבל ל-$NBA$ ללא קולג או עם פחות שנים ממשהו אחר, בהנתן ששאר המשתנים זהים, אז לגיטימי להניח שיש לו כישרון גדול יותר - מאחר והוא זקוק לפחות שנות אימון בקולג כדיי להגיע לרמת מקצועיות שמתאימה ל-$NBA$. 

### (ד)

```R
Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) 73.59034   35.93341   2.048  0.04156 *  
exper        2.86383    0.61272   4.674 4.72e-06 ***
exper_2     -0.12807    0.05244  -2.442  0.01525 *  
age         -3.98369    2.68908  -1.481  0.13969    
age_2        0.05355    0.04919   1.089  0.27732    
coll        -1.31260    0.45108  -2.910  0.00392 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 5.508 on 263 degrees of freedom
Multiple R-squared:  0.1451,    Adjusted R-squared:  0.1288 
F-statistic: 8.925 on 5 and 263 DF,  p-value: 7.615e-08
```

המשתנה $age^2$ אינו רלוונטי על פי ממצאי המודל המורחב. התשואה השולית הפוחתת של גיל / שחיקה מקצועית נתפסת כבר על ידי $exper - exper^{2}$ . 


### (ו)
```R
Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  6.779038   0.845421   8.019 3.53e-14 ***
points       0.077730   0.007113  10.928  < 2e-16 ***
exper        0.217845   0.049788   4.375 1.75e-05 ***
exper_2     -0.007082   0.002769  -2.558   0.0111 *  
age         -0.048137   0.034947  -1.377   0.1695    
coll        -0.040271   0.052872  -0.762   0.4469    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.6367 on 263 degrees of freedom
Multiple R-squared:  0.4878,    Adjusted R-squared:  0.4781 
F-statistic:  50.1 on 5 and 263 DF,  p-value: < 2.2e-16
```

התוצאות: 
למספר הנקודות יש תשואה שולית חיובית על לוג השכר, כך גם לניסיון עד מספר שנים מסוים, אבל התשואה השולית של ניסיון היא פחותת. בהנתן ניסיון ונקודות וקולג, לגיל יש השפעה שלילית על לוג השכר, וכך גם בהנתן גיל ניסיון ונקודות - למספר שנים בקולג יש השפעה שלילית על לוג השכר. 

### סעיף (ז)
נגדיר מודל מוגבל שבו - $\beta_{4}=\beta_{5}=0$ , ונגדיר מבחן $f$:
$$
R: \ln(wage) = \beta_{0}+ \beta_{1} exper + \beta_{2} ex per^2
$$
ואז:
$$
f = \frac{(ESS_{R}-ESS_{U})/ 2}{ESS_{U} / 263}
$$
```R
model_r <- lm(lwage ~ points + exper + exper_2, data = data)
ess_u <- sum(residuals(model_wage)^2)
ess_r <- sum(residuals(model_r)^2)
d <- 2
df <- 263
f_val <- ((ess_r - ess_u) / 2) / ((ess_u) / 262)
print(f_val)
----
[1] 1.184549
```

**התוצאה**: לא דוחים את $H_{0}$, המשתנים $age,coll$ יחד אינם מובהקים, וככל הנראה שהמשתנה $ex p - exp^{2}$ מספיק כדיי להסביר את השינוי בשכר, מאחר ובן אדם מבוגר יותר יהיה לרוב עם יותר ניסיון, וכך גם בן אדם שלא הלך לקולג הרבה שנים. 

